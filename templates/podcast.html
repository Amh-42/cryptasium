{% extends "base.html" %}

{% block title %}Podcast | Cryptasium{% endblock %}
{% block meta_title %}Podcast | Cryptasium Tech Conversations{% endblock %}
{% block meta_description %}Listen to the Cryptasium podcast. Conversations with engineers, futurists, and creators about the ethics and philosophy of technology.{% endblock %}
{% block meta_keywords %}Cryptasium podcast, tech podcast, programming podcast, AI podcast, software engineering podcast, tech interviews, developer podcast{% endblock %}
{% block canonical_url %}https://cryptasium.com/podcast{% endblock %}
{% block og_url %}https://cryptasium.com/podcast{% endblock %}
{% block og_type %}music.album{% endblock %}
{% block og_title %}Podcast | Cryptasium Tech Conversations{% endblock %}
{% block og_description %}Conversations with engineers, futurists, and creators about technology and its impact on society.{% endblock %}
{% block twitter_url %}https://cryptasium.com/podcast{% endblock %}
{% block twitter_title %}Podcast | Cryptasium{% endblock %}
{% block twitter_description %}Conversations with engineers, futurists, and creators about technology.{% endblock %}

{% block content %}
<!-- HERO SECTION -->
<header>
    <div class="container">
        <div class="hero-visual reveal">
            <div id="crystal-container"></div>
        </div>
        <div class="reveal">
            <div class="tag">● PODCAST</div>
            <h1>PODCAST.</h1>
            <p class="hero-desc">A WHISPER OF MYSTERY.</p>
            <div style="display: flex; gap: 16px; justify-content: center;">
                <a href="#episodes" class="btn btn-primary">Latest Episode</a>
                <a href="{{ url_for('index') }}" class="btn btn-outline">Back to Home</a>
            </div>
        </div>
    </div>
</header>

<!-- PODCAST EPISODES -->
<section id="episodes" class="container" style="padding: 100px 24px;">
    <div class="reveal">
        <h2 style="font-size: 48px; text-align: center; margin-bottom: 60px;">All Episodes</h2>
    </div>
    <div class="content-grid">
        {% if podcasts.items %}
            {% for podcast in podcasts.items %}
            <div class="content-card reveal">
                {% if podcast.thumbnail_url %}
                <div style="height: 200px; margin-bottom: 20px; background-image: url('{{ podcast.thumbnail_url }}'); background-size: cover; background-position: center; border-radius: 12px; position: relative;">
                    <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3);">
                        <i class="ph ph-microphone" style="font-size: 48px; color: white;"></i>
                    </div>
                </div>
                {% else %}
                <div class="video-placeholder" style="height: 200px; margin-bottom: 20px;">
                    <i class="ph ph-microphone placeholder-icon"></i>
                    <span class="placeholder-text">Episode {{ podcast.episode_number or '' }}</span>
                </div>
                {% endif %}
                <h3 style="margin-bottom: 12px;">{{ podcast.title }}</h3>
                <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 16px;">{{ podcast.description[:150] if podcast.description else 'Listen to the full episode...' }}...</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                    <span style="color: var(--text-muted); font-size: 12px; font-family: var(--font-mono);">{{ podcast.duration or '' }} • {{ podcast.created_at.strftime('%b %d') if podcast.created_at else '' }}</span>
                    <span style="color: var(--text-muted); font-size: 12px;">{{ podcast.views }} views</span>
                </div>
                {% if podcast.audio_url %}
                <audio controls style="width: 100%; margin-top: 16px;">
                    <source src="{{ podcast.audio_url }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
        <div class="reveal" style="grid-column: 1 / -1; text-align: center; padding: 60px 0;">
            <p style="color: var(--text-muted); font-size: 18px;">No podcast episodes yet. Check back soon!</p>
        </div>
        {% endif %}
    </div>

    <!-- PAGINATION -->
    {% if podcasts.pages > 1 %}
    <div class="pagination">
        {% if podcasts.has_prev %}
        <a href="{{ url_for('podcast_list', page=podcasts.prev_num) }}">Previous</a>
        {% endif %}
        
        {% for page_num in podcasts.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if page_num == podcasts.page %}
                <span class="current">{{ page_num }}</span>
                {% else %}
                <a href="{{ url_for('podcast_list', page=page_num) }}">{{ page_num }}</a>
                {% endif %}
            {% else %}
            <span>...</span>
            {% endif %}
        {% endfor %}
        
        {% if podcasts.has_next %}
        <a href="{{ url_for('podcast_list', page=podcasts.next_num) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</section>
{% endblock %}

{% block extra_css %}
<style>
    #crystal-container {
        width: 100%;
        height: 250px;
        position: relative;
        cursor: grab;
    }
    #crystal-container:active { cursor: grabbing; }
    #crystal-container canvas { width: 100% !important; height: 100% !important; display: block; }
    @media (max-width: 768px) { #crystal-container { height: 200px; } }
</style>
{% endblock %}

{% block extra_js %}
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
<script>
window.addEventListener('load', function() {
    const container = document.getElementById('crystal-container');
    if (!container || typeof THREE === 'undefined') return;
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 1, 1000);
    camera.position.z = 8;
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setClearColor(0x000000, 0);
    container.appendChild(renderer.domElement);
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.enableZoom = true;
    controls.enablePan = false;
    controls.minDistance = 4;
    controls.maxDistance = 15;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 2;

    // 3D extruded icon from PNG
    let mainColor = 0x0ea5e9;
    const group = new THREE.Group();
    
    // Load microphone icon texture
    const loader = new THREE.TextureLoader();
    loader.load('{{ url_for("static", filename="images/3329379.png") }}', (texture) => {
        texture.minFilter = THREE.LinearFilter;
        texture.magFilter = THREE.LinearFilter;
        
        // Front face with icon
        const frontMat = new THREE.MeshPhongMaterial({
            map: texture,
            transparent: true,
            alphaTest: 0.1,
            color: mainColor,
            emissive: mainColor,
            emissiveIntensity: 0.15,
            side: THREE.FrontSide
        });
        
        // Back and sides material (solid color)
        const sideMat = new THREE.MeshPhongMaterial({
            color: mainColor,
            emissive: mainColor,
            emissiveIntensity: 0.2,
            specular: 0xffffff,
            shininess: 100,
            transparent: true,
            opacity: 0.95
        });
        
        // Create extruded box for 3D effect
        const size = 4;
        const depth = 0.8;
        const geo = new THREE.BoxGeometry(size, size, depth);
        
        // Apply different materials to faces [right, left, top, bottom, front, back]
        const materials = [sideMat, sideMat, sideMat, sideMat, frontMat, frontMat];
        const mesh = new THREE.Mesh(geo, materials);
        group.add(mesh);
        
        // Glow plane behind
        const glowGeo = new THREE.PlaneGeometry(size * 1.3, size * 1.3);
        const glowMat = new THREE.MeshBasicMaterial({
            color: mainColor,
            transparent: true,
            opacity: 0.15,
            side: THREE.DoubleSide
        });
        const glow = new THREE.Mesh(glowGeo, glowMat);
        glow.position.z = -depth;
        group.add(glow);
        
        // Store materials for color change
        group.userData = { frontMat, sideMat, glowMat };
    });
    
    scene.add(group);

    // Lights
    const spot1 = new THREE.SpotLight(0xffffff); spot1.position.set(24, 10, 10); spot1.angle = 0.45; spot1.penumbra = 0.2; spot1.intensity = 1.2; scene.add(spot1);
    const point1 = new THREE.PointLight(mainColor); point1.position.set(-8, 4, 15); point1.intensity = 0.8; scene.add(point1);
    const point2 = new THREE.PointLight(0xffffff); point2.position.set(10, -2, -19); point2.intensity = 0.3; scene.add(point2);
    const point3 = new THREE.PointLight(mainColor); point3.position.set(-2, 10, 10); point3.intensity = 0.5; scene.add(point3);
    const ambientLight = new THREE.AmbientLight(0x606060, 0.6); scene.add(ambientLight);

    const colors = [0x0ea5e9, 0xff2222, 0x10b981, 0xa855f7, 0xf59e0b];
    let colorIndex = 0;
    container.addEventListener('click', () => {
        colorIndex = (colorIndex + 1) % colors.length;
        const newColor = colors[colorIndex];
        mainColor = newColor;
        if (group.userData.frontMat) {
            group.userData.frontMat.color.setHex(newColor);
            group.userData.frontMat.emissive.setHex(newColor);
            group.userData.sideMat.color.setHex(newColor);
            group.userData.sideMat.emissive.setHex(newColor);
            group.userData.glowMat.color.setHex(newColor);
        }
        point1.color.setHex(newColor); point3.color.setHex(newColor);
    });

    function onWindowResize() { if (!container) return; camera.aspect = container.clientWidth / container.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(container.clientWidth, container.clientHeight); }
    window.addEventListener('resize', onWindowResize);
    let floatTime = 0;
    function animate() { 
        requestAnimationFrame(animate); 
        floatTime += 0.02; 
        group.position.y = Math.sin(floatTime) * 0.3; 
        controls.update(); 
        renderer.render(scene, camera); 
    }
    animate();
});
</script>
{% endblock %}

