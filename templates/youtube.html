{% extends "base.html" %}

{% block title %}YouTube | Cryptasium{% endblock %}

{% block content %}
<!-- HERO SECTION -->
<header>
    <div class="container">
        <div class="hero-visual reveal">
            <div id="crystal-container"></div>
        </div>
        <div class="reveal">
            <div class="tag">● VIDEO ESSAYS</div>
            <h1>YOUTUBE.</h1>
            <p class="hero-desc">LENS OF MYSTERY.</p>
            <div style="display: flex; gap: 16px; justify-content: center;">
                <a href="#videos" class="btn btn-primary">Latest Episode</a>
                <a href="{{ url_for('index') }}" class="btn btn-outline">Back to Home</a>
            </div>
        </div>
    </div>
</header>

<!-- LATEST VIDEOS -->
<section id="videos" class="container" style="padding: 100px 24px;">
    <div class="reveal">
        <h2 style="font-size: 48px; text-align: center; margin-bottom: 60px;">Latest Episodes</h2>
    </div>
    <div class="content-grid">
        {% if videos.items %}
            {% for video in videos.items %}
            <div class="content-card reveal">
                {% if video.thumbnail_url %}
                <div onclick="openVideoModal('{{ video.video_id }}', '{{ video.title|replace("'", "\\'") }}', '{{ video.duration }}', false)" style="height: 200px; margin-bottom: 20px; background-image: url('{{ video.thumbnail_url }}'); background-size: cover; background-position: center; border-radius: 12px; position: relative; cursor: pointer; transition: transform 0.2s;">
                    <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3); border-radius: 12px; transition: background 0.2s;">
                        <i class="ph ph-play-circle" style="font-size: 64px; color: white; transition: transform 0.2s;"></i>
                    </div>
                </div>
                {% else %}
                <div onclick="openVideoModal('{{ video.video_id }}', '{{ video.title|replace("'", "\\'") }}', '{{ video.duration }}', false)" class="video-placeholder" style="height: 200px; margin-bottom: 20px; cursor: pointer;">
                    <i class="ph ph-play-circle placeholder-icon"></i>
                    <span class="placeholder-text">Episode</span>
                </div>
                {% endif %}
                <h3 style="margin-bottom: 12px;">{{ video.title }}</h3>
                <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 16px;">{{ video.description[:150] if video.description else 'Watch the full episode...' }}...</p>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                    <span style="color: var(--text-muted); font-size: 12px; font-family: var(--font-mono);">{{ video.duration or '' }} • {{ video.created_at.strftime('%b %d') if video.created_at else '' }}</span>
                    <span style="color: var(--text-muted); font-size: 12px;">{{ video.views or 0 }} views</span>
                </div>
                {% if video.video_id %}
                <button onclick="openVideoModal('{{ video.video_id }}', '{{ video.title|replace("'", "\\'") }}', '{{ video.duration }}', false)" class="btn btn-primary" style="width: 100%; margin-top: 16px; text-align: center;">
                    <i class="ph ph-play"></i> Watch Now
                </button>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
        <div class="reveal" style="grid-column: 1 / -1; text-align: center; padding: 60px 0;">
            <p style="color: var(--text-muted); font-size: 18px;">No videos yet. Check back soon!</p>
        </div>
        {% endif %}
    </div>

    <!-- PAGINATION -->
    {% if videos.pages > 1 %}
    <div class="pagination">
        {% if videos.has_prev %}
        <a href="{{ url_for('youtube_list', page=videos.prev_num) }}">Previous</a>
        {% endif %}
        
        {% for page_num in videos.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                {% if page_num == videos.page %}
                <span class="current">{{ page_num }}</span>
                {% else %}
                <a href="{{ url_for('youtube_list', page=page_num) }}">{{ page_num }}</a>
                {% endif %}
            {% else %}
            <span>...</span>
            {% endif %}
        {% endfor %}
        
        {% if videos.has_next %}
        <a href="{{ url_for('youtube_list', page=videos.next_num) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</section>
{% endblock %}

{% block extra_css %}
<style>
    #crystal-container {
        width: 100%;
        height: 250px;
        position: relative;
        cursor: grab;
    }
    #crystal-container:active { cursor: grabbing; }
    #crystal-container canvas { width: 100% !important; height: 100% !important; display: block; }
    @media (max-width: 768px) { #crystal-container { height: 200px; } }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
<script>
(function() {
    const container = document.getElementById('crystal-container');
    if (!container) return;
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 1, 1000);
    camera.position.z = 10;
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setClearColor(0x000000, 0);
    container.appendChild(renderer.domElement);
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.enableZoom = true;
    controls.enablePan = false;
    controls.minDistance = 5;
    controls.maxDistance = 20;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 1.5;

    // YouTube Play Button - Rounded rectangle with triangle
    let mainColor = 0xff0000; // YouTube red
    const group = new THREE.Group();
    
    // Rounded rectangle background
    const roundedRectShape = new THREE.Shape();
    const w = 4, h = 2.8, r = 0.5;
    roundedRectShape.moveTo(-w/2 + r, -h/2);
    roundedRectShape.lineTo(w/2 - r, -h/2);
    roundedRectShape.quadraticCurveTo(w/2, -h/2, w/2, -h/2 + r);
    roundedRectShape.lineTo(w/2, h/2 - r);
    roundedRectShape.quadraticCurveTo(w/2, h/2, w/2 - r, h/2);
    roundedRectShape.lineTo(-w/2 + r, h/2);
    roundedRectShape.quadraticCurveTo(-w/2, h/2, -w/2, h/2 - r);
    roundedRectShape.lineTo(-w/2, -h/2 + r);
    roundedRectShape.quadraticCurveTo(-w/2, -h/2, -w/2 + r, -h/2);
    
    const bgGeo = new THREE.ExtrudeGeometry(roundedRectShape, { depth: 0.6, bevelEnabled: true, bevelThickness: 0.1, bevelSize: 0.1, bevelSegments: 3 });
    const bgMat = new THREE.MeshPhongMaterial({ color: mainColor, emissive: mainColor, emissiveIntensity: 0.2, specular: 0xffffff, opacity: 0.95, transparent: true, shininess: 100 });
    const bgMesh = new THREE.Mesh(bgGeo, bgMat);
    bgMesh.position.z = -0.3;
    group.add(bgMesh);
    
    // Play triangle
    const triShape = new THREE.Shape();
    triShape.moveTo(-0.5, -0.7);
    triShape.lineTo(-0.5, 0.7);
    triShape.lineTo(0.8, 0);
    triShape.lineTo(-0.5, -0.7);
    const triGeo = new THREE.ExtrudeGeometry(triShape, { depth: 0.3, bevelEnabled: true, bevelThickness: 0.05, bevelSize: 0.05, bevelSegments: 2 });
    const triMat = new THREE.MeshPhongMaterial({ color: 0xffffff, emissive: 0xffffff, emissiveIntensity: 0.1, specular: 0xffffff, shininess: 100 });
    const triMesh = new THREE.Mesh(triGeo, triMat);
    triMesh.position.set(0.1, 0, 0.2);
    group.add(triMesh);
    
    group.position.set(0, 0, 0);
    scene.add(group);

    // Lights
    const spot1 = new THREE.SpotLight(0xffffff); spot1.position.set(24, 10, 10); spot1.angle = 0.45; spot1.penumbra = 0.2; spot1.intensity = 1; scene.add(spot1);
    const point1 = new THREE.PointLight(mainColor); point1.position.set(-8, 4, 15); point1.intensity = 0.8; scene.add(point1);
    const point2 = new THREE.PointLight(0xffffff); point2.position.set(10, -2, -19); point2.intensity = 0.25; scene.add(point2);
    const point3 = new THREE.PointLight(mainColor); point3.position.set(-2, 10, 10); point3.intensity = 0.42; scene.add(point3);
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5); scene.add(ambientLight);

    const colors = [0xff0000, 0x0ea5e9, 0x10b981, 0xa855f7, 0xf59e0b];
    let colorIndex = 0;
    container.addEventListener('click', () => {
        colorIndex = (colorIndex + 1) % colors.length;
        const newColor = colors[colorIndex];
        bgMat.color.setHex(newColor); bgMat.emissive.setHex(newColor);
        point1.color.setHex(newColor); point3.color.setHex(newColor);
    });

    function onWindowResize() { if (!container) return; camera.aspect = container.clientWidth / container.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(container.clientWidth, container.clientHeight); }
    window.addEventListener('resize', onWindowResize);
    let floatTime = 0;
    function animate() { requestAnimationFrame(animate); floatTime += 0.02; group.position.y = Math.sin(floatTime) * 0.3; group.rotation.y = Math.sin(floatTime * 0.5) * 0.1; controls.update(); renderer.render(scene, camera); }
    animate();
})();
</script>
{% endblock %}

